{% extends 'index.html' %}
{% comment %} TODO: FIX THE CODE OF QUANTITY SELECTION {% endcomment %}
{% block content %}
<div class="pagetitle">
  <h1>{% if not portfolio.pk %}Create Portfolio{% else %}Update Portfolio{% endif %}</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="index.html">Portfolio</a></li>
      <li class="breadcrumb-item active">{% if not portfolio.pk %}Create Portfolio{% else %}Update Portfolio{% endif %}</li>
    </ol>
  </nav>
</div><!-- End Page Title -->

{% comment %} <section class="section">
  <div class="row">
    <div class="col-lg-6">

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Horizontal Form</h5>

          <!-- Horizontal Form -->
          <form method="post">
            {% csrf_token %}
            <div class="row mb-3">
              <label for="inputEmail3" class="col-sm-2 col-form-label">Your Name</label>
              <div class="col-sm-10">
                <input type="text" class="form-control" id="inputText">
              </div>
            </div>
            <div class="row mb-3">
              <label for="inputEmail3" class="col-sm-2 col-form-label">Email</label>
              <div class="col-sm-10">
                <input type="email" class="form-control" id="inputEmail">
              </div>
            </div>
            <div class="row mb-3">
              <label for="inputPassword3" class="col-sm-2 col-form-label">Password</label>
              <div class="col-sm-10">
                <input type="password" class="form-control" id="inputPassword">
              </div>
            </div>
            <fieldset class="row mb-3">
              <legend class="col-form-label col-sm-2 pt-0">Radios</legend>
              <div class="col-sm-10">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios1" value="option1" checked>
                  <label class="form-check-label" for="gridRadios1">
                    First radio
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios2" value="option2">
                  <label class="form-check-label" for="gridRadios2">
                    Second radio
                  </label>
                </div>
                <div class="form-check disabled">
                  <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios3" value="option3" disabled>
                  <label class="form-check-label" for="gridRadios3">
                    Third disabled radio
                  </label>
                </div>
              </div>
            </fieldset>
            <div class="row mb-3">
              <div class="col-sm-10 offset-sm-2">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="gridCheck1">
                  <label class="form-check-label" for="gridCheck1">
                    Example checkbox
                  </label>
                </div>
              </div>
            </div>
            <div class="text-center">
              <button type="submit" class="btn btn-primary">Submit</button>
              <button type="reset" class="btn btn-secondary">Reset</button>
            </div>
          </form><!-- End Horizontal Form -->
        </div>
      </div>
    </div>
  </div>
</section> {% endcomment %}
  <h2>{% if not portfolio.pk %}Create Portfolio{% else %}Update Portfolio{% endif %}</h2>
  <form method="post" id="portfolio-form">
    {% csrf_token %}
    {{ form.as_p }}

    <table id="asset-table">
      <thead>
        <tr>
          <th>Asset Ticker</th>
          <th>Quantity</th>
          <th>Remove?</th>
        </tr>
      </thead>
      <tbody>
        {{ formset.management_form }}
        {% for form in formset %}
          <tr class="formset-row">
            <td>{{ form.asset_ticker }}</td>
            <td>{{ form.quantity }}</td>
            <td><button type="button" class="remove-row-btn" disabled>Remove</button></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <button type="button" id="add-row-btn">Add Asset</button>
    <button type="submit">Submit Portfolio</button>
  </form>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const addButton = document.getElementById('add-row-btn');
      let formIndex = '{{ formset.total_form_count }}';
      const assetTableBody = document.getElementById('asset-table').querySelector('tbody');
  
      addButton.addEventListener('click', () => {
          let newRowHtml = '{{ formset.empty_form | escapejs }}';
          newRowHtml = newRowHtml.replace(/__prefix__/g, formIndex);
          assetTableBody.insertAdjacentHTML('beforeend', newRowHtml);
          formIndex++;
          document.getElementById('id_form-TOTAL_FORMS').value = formIndex;
          updateRemoveButtons();
      });
  
      assetTableBody.addEventListener('click', (event) => {
          if (event.target.classList.contains('remove-row-btn')) {
              event.target.closest('tr').remove();
              updateRemoveButtons();
          }
      });
  
      function updateRemoveButtons() {
          const removeButtons = assetTableBody.querySelectorAll('.remove-row-btn');
          removeButtons.forEach(btn => btn.disabled = removeButtons.length === 1);
      }
  
      updateRemoveButtons(); // Initial update
  });
  </script>
{% endblock %}